<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Admin - Drug Management</title>

<style>
body {
    margin: 0;
    font-family: 'Pretendard', 'Segoe UI', sans-serif;
    background: #f4f7fb;
    color: #333;
}

header {
    background: linear-gradient(90deg, #4e73df, #2e59d9);
    color: white;
    padding: 20px 40px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}

header h1 {
    margin: 0;
    font-size: 20px;
}

.logout-btn {
    background: white;
    color: #2e59d9;
    border: none;
    padding: 8px 14px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
}

.logout-btn:hover {
    background: #e2e6f5;
}

.container {
    max-width: 1000px;
    margin: 40px auto;
    padding: 20px;
}

.card {
    background: white;
    border-radius: 15px;
    padding: 25px;
    margin-bottom: 25px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.08);
}

.card h2 {
    margin-top: 0;
    margin-bottom: 20px;
    color: #4e73df;
}

.warning {
    background: #fff3cd;
    padding: 15px;
    border-radius: 10px;
    color: #856404;
    margin-bottom: 25px;
    font-size: 14px;
}

input {
    width: 100%;
    padding: 8px;
    margin-bottom: 10px;
    border-radius: 8px;
    border: 1px solid #ddd;
}

input:focus {
    outline: none;
    border-color: #4e73df;
    box-shadow: 0 0 5px rgba(78,115,223,0.4);
}

button {
    padding: 8px 14px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    font-weight: 600;
    transition: 0.2s;
}

.primary-btn {
    background: #4e73df;
    color: white;
}

.primary-btn:hover {
    background: #2e59d9;
}

.danger-btn {
    background: #e74a3b;
    color: white;
}

.danger-btn:hover {
    background: #c0392b;
}

.search-row {
    display: flex;
    gap: 10px;
}

.search-row input {
    flex: 1;
}

.medicine-box {
    border: 1px solid #eee;
    padding: 15px;
    border-radius: 10px;
    margin-bottom: 15px;
    background: #f9fbff;
}
</style>
</head>

<body>

<header>
    <h1>ğŸ›  ê´€ë¦¬ì - ì•½í’ˆ ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
    <button class="logout-btn" onclick="goDocs()">API Docs</button>
    <button class="logout-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
</header>

<div class="container">

    <div class="warning">
        âš ï¸ ì´ í˜ì´ì§€ëŠ” ê´€ë¦¬ì ì „ìš©ì…ë‹ˆë‹¤.  
        ìˆ˜ì • ë° ì‚­ì œëŠ” ì¦‰ì‹œ DBì— ë°˜ì˜ë©ë‹ˆë‹¤.
    </div>

    <!-- ì•½ ì¶”ê°€ -->
    <div class="card">
        <h2>1ï¸âƒ£ ì•½ ì¶”ê°€</h2>

        <input id="new-name" placeholder="ì•½ ì´ë¦„">
        <input id="new-desc" placeholder="í•œ ì¤„ ì„¤ëª…">
        <input id="new-dosage" placeholder="ë³µìš©ë°©ë²•">
        <input id="new-caution" placeholder="ì£¼ì˜ì‚¬í•­">

        <button class="primary-btn" onclick="createMedicine()">ì¶”ê°€</button>
    </div>

    <!-- ê²€ìƒ‰ -->
    <div class="card">
        <h2>2ï¸âƒ£ ì•½ ê²€ìƒ‰</h2>
        <div class="search-row">
            <input type="text" id="searchInput" placeholder="ì•½ ì´ë¦„ ì…ë ¥">
            <button class="primary-btn" onclick="searchMedicine()">ê²€ìƒ‰</button>
        </div>
    </div>

    <!-- ëª©ë¡ -->
    <div class="card">
        <h2>3ï¸âƒ£ ê²€ìƒ‰ ê²°ê³¼</h2>
        <div id="medicineList"></div>
    </div>

</div>

<script>
function logout() {
    window.location.href = "/login";
}

function goDocs() {
    window.location.href = "/docs";
}

async function searchMedicine() {
    const keyword = document.getElementById("searchInput").value;
    if (!keyword.trim()) return;

    const res = await fetch(`/medicines/search?name=${encodeURIComponent(keyword)}`, {});

    if (!res.ok) {
        alert("ê²€ìƒ‰ ì‹¤íŒ¨ (ê¶Œí•œ ë˜ëŠ” ì„œë²„ ë¬¸ì œ)");
        return;
    }

    const data = await res.json();
    const list = document.getElementById("medicineList");
    list.innerHTML = "";

    if (data.length === 0) {
        list.innerHTML = "<p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p >";
        return;
    }

    data.forEach(med => {
        const div = document.createElement("div");
        div.className = "medicine-box";

        div.innerHTML = `
            <b>ID:</b> ${med.id}<br><br>

            <input id="name-${med.id}" value="${med.name}">
            <input id="desc-${med.id}" value="${med.description || ""}">
            <input id="dosage-${med.id}" value="${med.dosage}">
            <input id="caution-${med.id}" value="${med.caution}">

            <button class="primary-btn" onclick="updateMedicine(${med.id})">ìˆ˜ì •</button>
            <button class="danger-btn" onclick="deleteMedicine(${med.id})">ì‚­ì œ</button>
        `;

        list.appendChild(div);
    });
}

async function updateMedicine(id) {
    if (!confirm("ì´ ì•½ ì •ë³´ë¥¼ ìˆ˜ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

    await fetch(`/medicines/${id}`, {
    method: "PUT",
    headers: {
        "Content-Type": "application/json"
    },
    body: JSON.stringify({
        name: document.getElementById(`name-${id}`).value,
        description: document.getElementById(`desc-${id}`).value,
        dosage: document.getElementById(`dosage-${id}`).value,
        caution: document.getElementById(`caution-${id}`).value
    })
});

    alert("ìˆ˜ì • ì™„ë£Œ");
}

async function deleteMedicine(id) {
    if (!confirm("âš ï¸ ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ë³µêµ¬ ë¶ˆê°€)")) return;

    const res = await fetch(`/medicines/${id}`, {
        method: "DELETE"
    });

    if (!res.ok) {
        alert("ì‚­ì œ ì‹¤íŒ¨ (ê¶Œí•œ ë˜ëŠ” ì„œë²„ ì˜¤ë¥˜)");
        return;
    }

    alert("ì‚­ì œ ì™„ë£Œ");
    searchMedicine();
}

async function createMedicine() {
    const name = document.getElementById("new-name").value;
    const description = document.getElementById("new-desc").value;
    const dosage = document.getElementById("new-dosage").value;
    const caution = document.getElementById("new-caution").value;

    if (!name || !dosage || !caution) {
        alert("ì´ë¦„, ë³µìš©ë°©ë²•, ì£¼ì˜ì‚¬í•­ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.");
        return;
    }

    await fetch("/medicines", {
        method: "POST",
        headers:{
            "Content-Type": "application/json"
        },
        body: JSON.stringify({ name, description, dosage, caution })
    });

    alert("ì¶”ê°€ ì™„ë£Œ!");

    document.getElementById("new-name").value = "";
    document.getElementById("new-desc").value = "";
    document.getElementById("new-dosage").value = "";
    document.getElementById("new-caution").value = "";

    searchMedicine();
}

</script>

</body>
</html>